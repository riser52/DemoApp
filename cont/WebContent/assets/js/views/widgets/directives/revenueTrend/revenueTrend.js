define(['angular', 'd3', ''], function(angular, d3){
	
	var RevenueTrend = angular.module('pbwApp2')
	.directive('wgtRevenueTrend', ['$http', '$timeout', '$filter', 'Helper', function($http, $timeout, $filter, Helper){
		

		return Helper.getBaseWidget().extend({
            restrict: 'C',
            cssClass: "col-xs-12 col-sm-12 col-md-12 revenueTrend",
            templateUrl: 'assets/js/views/widgets/directives/revenueTrend/revenueTrend.html',
            link: function(scope, elem, attrs){
            	
            	scope.optionsText = "Selected: All";
            	scope.optionsNextText = "";
            	scope.optionsPrevText = "";
            	scope.options = [{name: "Total Revenue", selected: true, caption: "All"},
            	                 {name: "Type1", selected: true},
            	                 {name: "Short", selected: true},
            	                 {name: "PTH", selected: true},
            	                 {name: "Long", selected: true},
            	                 {name: "Cash", selected: true}];
            	
            	scope.colorShades = ['yellow', 'orange', 'red', '#3687FF', '#4E9FA5', '#F26522', '#676766', '#2C4D75', '#C0504D', '#0247FE'];
            	
                var max = new Date(), data = null,
                	dummyData = [],
                	t0 = new Date(), t1 = new Date(), t2 = new Date(), t3 = new Date(); 
                max.setDate(max.getDate() + 3);
                t0.setDate(t0.getDate()+1);
                t1.setDate(t1.getDate()+2);
                t2.setDate(t2.getDate()+3);
                t3.setDate(t3.getDate()+4);

                for (i = 368; i >= 0; i--) {
                	var d = new Date();
                    d.setDate(max.getDate() - i);
                    if(i < 3){
                    	data = {
                                date: d.getTime(),
                                revenue: {
                                    "Type1": 0.4 * (2 + Math.cos(Math.PI * 2 * i / 368)) * ( 100 - 20 * Math.random() ),
                                    "Short": 80 - 20 * Math.random(),
                                    "PTH": 90 - 20 * Math.random(),
                                    "Long": 60 - 20 * Math.random(),
                                    "Cash": 60 - 20 * Math.random()
                                },
                                regcap: {
                                    "Type1": 105 - 10 * Math.random(),
                                    "Short": 85 - 10 * Math.random(),
                                    "PTH": 95 - 10 * Math.random(),
                                    "Long": 65 - 10 * Math.random(),
                                    "Cash": 65 - 10 * Math.random()
                                }
                            };
                    } else {
                    	data = {
                            date: d.getTime(),
                            revenue: {
                                "Type1": 0.38 * (2 + Math.cos(Math.PI * 2 * i / 368)) * ( 100 - 80 * Math.random() ),
                                "Short": 80 - 50 * Math.random(),
                                "PTH": 90 - 80 * Math.random(),
                                "Long": 60 - 50 * Math.random(),
                                "Cash": 60 - 20 * Math.random()
                            },
                            regcap: {
                                "Type1": 105 - 10 * Math.random(),
                                "Short": 85 - 10 * Math.random(),
                                "PTH": 95 - 10 * Math.random(),
                                "Long": 65 - 10 * Math.random(),
                                "Cash": 65 - 10 * Math.random()
                            }
                        };
                    }
                    data.revenue["Total Revenue"] = data.revenue.Type1
                    							+ data.revenue.Short
                    							+ data.revenue.PTH
                    							+ data.revenue.Long
                    							+ data.revenue.Cash;
		
                    data.regcap["Total Revenue"] = data.regcap.Type1
							+ data.regcap.Short
							+ data.regcap.PTH
							+ data.regcap.Long
							+ data.regcap.Cash;
                    
                    dummyData.push(data);
                }
                
                scope.getColor = function(name, date){
                	if(date){
                		if(date> t2.getTime())
                			return scope.colorShades[2];
                		else if(date> t1.getTime())
                			return scope.colorShades[1];
                		else if(date> t0.getTime())
                			return scope.colorShades[0];
                	}
                	if(name == "Total Revenue")
                		return scope.colorShades[3];
                	else if(name == "Type1")
                		return scope.colorShades[4];
                	else if(name == "Short")
                		return scope.colorShades[5];
                	else if(name == "PTH")
                		return scope.colorShades[6];
                	else if(name == "Long")
                		return scope.colorShades[7];
                	else if(name == "Cash")
                		return scope.colorShades[8];
                }
                
                scope.setChartConfig = function(){
                	var series = {}, categories = [], 
                		seriesList = [], colors = [],
                		isAll = scope.options[0].selected === true;
                	
                	for(var j=0, ln = dummyData.length; j < ln; j++){
                		categories.push(dummyData[j].date);
                		
                		if( isAll ){
                			if( !series[ scope.options[0].name ] )
                				series[ scope.options[0].name ] = [];
                			series[ scope.options[0].name ].push({x: dummyData[j].date, y:dummyData[j].revenue[ scope.options[0].name ], color: scope.getColor(scope.options[0].name, dummyData[j].date) });
                		}else {
		                	for(var i =0; i < scope.options.length; i++){
		                		if(!scope.options[i].selected)
		                			continue;
	                			if( !series[ scope.options[i].name ] )
	                				series[ scope.options[i].name ] = [];
	                			series[ scope.options[i].name ].push({x: dummyData[j].date, y: dummyData[j].revenue[ scope.options[i].name ], color: scope.getColor(scope.options[i].name, dummyData[j].date) });
	                    	}
                		}
                	}
                	//console.log(colors);
                	for(var l in series){
                		seriesList.push( {
                							type: 'column', 
                							name: l, 
                							data: series[l], 
                							dataGrouping: {
					                            enabled: false
					                        },
					                        color: scope.getColor(l)
                						} 
                		);
                	}

	            	scope.chartConfig = {
	                    chart: {
	                    	alignTicks: false,
	                        height: 290,
	                        backgroundColor: 'transparent',
	                        spacing: [5,70,3,10],
	                        marginRight: 70,
	                        marginBottom: 10
	                    },
	                    //colors: ['#819498'],
	                    title: {
	                        text: ' '
	                    },
	                    xAxis: {
	                        categories: categories,
	                        title: {
	                            text: ' '
	                        }
	                    	/*,
	                        plotLines: [{
	                            value: t1.getTime(),
	                            color: scope.colorShades[1],
	                            dashStyle: 'shortdash',
	                            width: 2,
	                            label: {
	                                text: Highcharts.dateFormat('%e %b %Y', t0.getTime())
	                            }
	                        },{
	                            value: t2.getTime(),
	                            color: scope.colorShades[2],
	                            dashStyle: 'shortdash',
	                            width: 2,
	                            label: {
	                                text: Highcharts.dateFormat('%e %b %Y', t1.getTime())
	                            }
	                        }, {
	                            value: t3.getTime(),
	                            color: scope.colorShades[3],
	                            dashStyle: 'shortdash',
	                            width: 2,
	                            label: {
	                                text: Highcharts.dateFormat('%e %b %Y', t2.getTime())
	                            }
	                        }]*/
	                    },
	                    yAxis: {
	                        min: 0,
	                        title: {
	                            text: ' '
	                        },
	                        labels:{
	                        	x: 25
	                        },
	                        gridLineWidth: 0,
	                        stackLabels: {
	                            enabled: false,
	                            style: {
	                                fontWeight: 'bold',
	                                color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
	                            }
	                        }
	                    },

	                    tooltip: {
	                    	useHTML: true,
	                    	crosshair: true,
	                        formatter: function () {
	                            var str = '<b>' + Highcharts.dateFormat('%e %b %Y', this.x) + '</b><br />';
	                            
	                            if(this.x > t2.getTime())
	                            	str += '<strong>T+3 Projection</strong><br/>';
	                            else if(this.x > t1.getTime())
	                            	str += '<strong>T+2 Projection</strong><br/>';
	                            else if(this.x > t0.getTime())
	                            	str += '<strong>T+1 Projection</strong><br/>';
	                            
	                            str += '<table>'
	                            for(var i=0; i < this.points.length; i++){
	                            	str += '<tr style="color:'+ this.points[i].series.color +'"><td>' +this.points[i].series.name + ':</td><td class="text-right"> <b>' + Highcharts.numberFormat(this.points[i].point.y, 2) + '</b></td></tr>';
	                            }
	                            return str+'</table>';
	                        }
	                    },
	                    rangeSelector : {
	                    	selected: 1,
	                        inputEnabled: false, // it supports only days
	                    },
	                    plotOptions: {
	                        column: {
	                            stacking: 'normal',
	                            dataLabels: {
	                                enabled: false,
	                                color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
	                                style: {
	                                    textShadow: '0 0 3px black'
	                                }
	                            },
	                            grouping: false,
	                            pointPadding: 0,
	                            groupPadding: 0,
	                            borderWidth: 0.1,
	                            /*zoneAxis: 'x',
	                            zones: [{
	                            	value: t0.getTime(),
	                                color: scope.colorShades[0]
	                            },{
	                                value: t1.getTime(),
	                                color: scope.colorShades[1]
	                            }, {
	                                value: t2.getTime(),
	                                color: scope.colorShades[2]
	                            }, {
	                            	value: t3.getTime(),
	                                color: scope.colorShades[3]
	                            }]*/
	                        }
	                    },
	                    series: seriesList, 
	                    	//[{type: 'column', name:'Trend', data: [[1232496000000,275012619],[1232582400000,352381827],[1232668800000,190942374],[1232928000000,174853854],[1233014400000,154631463],[1233100800000,219701881],[1233187200000,148300005],[1233273600000,162955387],[1233532800000,139603352],[1233619200000,149860816],[1233705600000,202103258],[1233792000000,187353537],[1233878400000,171784417],[1234137600000,178749928],[1234224000000,212329642],[1234310400000,168776993],[1234396800000,204335663],[1234483200000,152266590],[1234828800000,169558382],[1234915200000,171142041],[1235001600000,230700547],[1235088000000,187575094],[1235347200000,196743015],[1235433600000,201773159],[1235520000000,208328001],[1235606400000,157513937],[1235692800000,176686048],[1235952000000,192742970],[1236038400000,181084918],[1236124800000,185381623],[1236211200000,176723638],[1236297600000,252786562],[1236556800000,174619354],[1236643200000,211126251],[1236729600000,211696254],[1236816000000,192203340],[1236902400000,150320072],[1237161600000,199386740],[1237248000000,197005102],[1237334400000,199050355],[1237420800000,125079465],[1237507200000,173926123],[1237766400000,166641097],[1237852800000,160856745],[1237939200000,161662886],[1238025600000,154062776],[1238112000000,123260683],[1238371200000,125715345],[1238457600000,142519909],[1238544000000,147398566],[1238630400000,203091462],[1238716800000,159086263],[1238976000000,164515624],[1239062400000,134196468],[1239148800000,113907367],[1239235200000,132734070],[1239580800000,97367053],[1239667200000,113688925],[1239753600000,103256790],[1239840000000,148395562],[1239926400000,124420674],[1240185600000,116663519],[1240272000000,117671008],[1240358400000,234691772],[1240444800000,236289193],[1240531200000,135236661],[1240790400000,120203433],[1240876800000,113964158],[1240963200000,114564555],[1241049600000,124622078],[1241136000000,99397235],[1241395200000,152395194],[1241481600000,99600312],[1241568000000,118410516],[1241654400000,132973925],[1241740800000,117006064],[1242000000000,101195717],[1242086400000,152369805],[1242172800000,148992221],[1242259200000,111976970],[1242345600000,91891240],[1242604800000,114771356],[1242691200000,93105509],[1242777600000,97193040],[1242864000000,102045258],[1242950400000,74517205],[1243296000000,159231429],[1243382400000,161740670],[1243468800000,121887528],[1243555200000,114163602],[1243814400000,113166984],[1243900800000,114055732],[1243987200000,141299592],[1244073600000,137657989],[1244160000000,158178874],[1244419200000,232912673],[1244505600000,169240876],[1244592000000,172199727],[1244678400000,131205851],[1244764800000,140771232],[1245024000000,134987111],[1245110400000,128701237],[1245196800000,142853172],[1245283200000,106920023],[1245369600000,180463626],[1245628800000,158728087],[1245715200000,176632470],[1245801600000,121381183],[1245888000000,147422191],[1245974400000,109867982],[1246233600000,141915494],[1246320000000,108562440],[1246406400000,103568150],[1246492800000,92653848],[1246838400000,124671533],[1246924800000,115445092],[1247011200000,143982048],[1247097600000,85786435],[1247184000000,111318256],[1247443200000,120943494],[1247529600000,86875418],[1247616000000,121396114],[1247702400000,98392161],[1247788800000,150538451],[1248048000000,183881187],[1248134400000,218695309],[1248220800000,218525832],[1248307200000,131740378],[1248393600000,109589914],[1248652800000,108327807],[1248739200000,90888133],[1248825600000,95607050],[1248912000000,117400808],[1248998400000,105672952],[1249257600000,98559874],[1249344000000,98952371],[1249430400000,105795333],[1249516800000,85443631],[1249603200000,96870928],[1249862400000,75108789],[1249948800000,88872154],[1250035200000,111267639],[1250121600000,110040595],[1250208000000,76512275],[1250467200000,131095251],[1250553600000,107787547],[1250640000000,103317865],[1250726400000,85549730],[1250812800000,104018292],[1251072000000,101732176],[1251158400000,81088343],[1251244800000,75999469],[1251331200000,112294826],[1251417600000,113464428],[1251676800000,77885087],[1251763200000,117256335],[1251849600000,91100107],[1251936000000,73525711],[1252022400000,93656654],[1252368000000,78761627],[1252454400000,202822886],[1252540800000,122783346],[1252627200000,87240188],[1252886400000,80502611],[1252972800000,106617553],[1253059200000,188505499],[1253145600000,202642664],[1253232000000,150436860],[1253491200000,109428907],[1253577600000,89240991],[1253664000000,148509963],[1253750400000,137719491],[1253836800000,111371862],[1254096000000,84411999],[1254182400000,86346379],[1254268800000,134895635],[1254355200000,131177739],[1254441600000,138358668],[1254700800000,105783062],[1254787200000,151270875],[1254873600000,116416909],[1254960000000,109552296],[1255046400000,73348345],[1255305600000,72037756],[1255392000000,87004582],[1255478400000,93942639],[1255564800000,93388722],[1255651200000,107856189],[1255910400000,235557336],[1255996800000,285259814],[1256083200000,298431525],[1256169600000,197847825],[1256256000000,105196434],[1256515200000,121084383],[1256601600000,189137473],[1256688000000,204596217],[1256774400000,142602061],[1256860800000,179380894],[1257120000000,169897231],[1257206400000,130635414],[1257292800000,121935499],[1257379200000,96230799],[1257465600000,73807363],[1257724800000,132213683],[1257811200000,100298380],[1257897600000,111019510],[1257984000000,90978853],[1258070400000,85832761],[1258329600000,121301019],[1258416000000,99128064],[1258502400000,93579864],[1258588800000,135581523],[1258675200000,101722565],[1258934400000,118793731],[1259020800000,79609194],[1259107200000,71662311],[1259280000000,73814244],[1259539200000,106213926],[1259625600000,116440583],[1259712000000,178814706],[1259798400000,112179578],[1259884800000,206776668],[1260144000000,178689658],[1260230400000,172599280],[1260316800000,171195185],[1260403200000,122417155],[1260489600000,107443378],[1260748800000,123947124],[1260835200000,104928453],[1260921600000,88279674],[1261008000000,97209056],[1261094400000,152192516],[1261353600000,153093108],[1261440000000,87378543],[1261526400000,86380987],[1261612800000,125221985],[1261958400000,161141050],[1262044800000,111301071],[1262131200000,103020708],[1262217600000,88102679],[1262563200000,123432050],[1262649600000,150476004],[1262736000000,138039594],[1262822400000,119282324],[1262908800000,111969081],[1263168000000,115557365],[1263254400000,148614774],[1263340800000,151472335],[1263427200000,108288411],[1263513600000,148584065],[1263859200000,182501620],[1263945600000,153037892],[1264032000000,152038565],[1264118400000,220441872],[1264377600000,266424802],[1264464000000,466777486],[1264550400000,430642030],[1264636800000,293375376],[1264723200000,311487785],[1264982400000,187468421],[1265068800000,174585313],[1265155200000,153831769],[1265241600000,189412762],[1265328000000,212576350],[1265587200000,119567119],[1265673600000,158221028],[1265760000000,92590218],[1265846400000,137585903],[1265932800000,163866906],[1266278400000,135987761],[1266364800000,109098710],[1266451200000,105706111],[1266537600000,103933466],[1266796800000,97706168],[1266883200000,143828223],[1266969600000,115141376],[1267056000000,166349071],[1267142400000,126865060],[1267401600000,137523183],[1267488000000,141636152],[1267574400000,93059694],[1267660800000,91509936],[1267747200000,224904603],[1268006400000,107472239],[1268092800000,230064660],[1268179200000,149054143],[1268265600000,101424638],[1268352000000,104080620],[1268611200000,123375091],[1268697600000,111726636],[1268784000000,112738997],[1268870400000,85527113],[1268956800000,139861148],[1269216000000,114104634],[1269302400000,150607177],[1269388800000,149570232],[1269475200000,135816674],[1269561600000,160218135],[1269820800000,135185785],[1269907200000,131827325],[1269993600000,107664557],[1270425600000,171126319],[1270512000000,111754188],[1270598400000,157125031],[1270684800000,143246621],[1270771200000,83545644],[1271030400000,83303836],[1271116800000,76552525],[1271203200000,101018554],[1271289600000,94195920],[1271376000000,187635966],[1271635200000,141730491],[1271721600000,184580977],[1271808000000,245597800],[1271894400000,198355815],[1271980800000,199238354],[1272240000000,119767011],[1272326400000,177335424],[1272412800000,189599970],[1272499200000,139709745],[1272585600000,135615676],[1272844800000,113585031],[1272931200000,180954830],[1273017600000,220775786],[1273104000000,321464892],[1273190400000,419004292],[1273449600000,246076208],[1273536000000,212587809],[1273622400000,163594375],[1273708800000,149927526],[1273795200000,189840357],[1274054400000,190708252],[1274140800000,195668956],[1274227200000,256431406],[1274313600000,320728737],[1274400000000,305976755],[1274659200000,188561359],[1274745600000,262003357],[1274832000000,212664144],[1274918400000,166575339],[1275004800000,203903217],[1275350400000,219118382],[1275436800000,172136524],[1275523200000,162539314],[1275609600000,189610442],[1275868800000,221745538],[1275955200000,250192019],[1276041600000,213657171],[1276128000000,194088937],[1276214400000,136439884],[1276473600000,150740100],[1276560000000,146268297],[1276646400000,195922370],[1276732800000,218365231],[1276819200000,196154945],[1277078400000,194122453],[1277164800000,179314996],[1277251200000,192113733],[1277337600000,178782814],[1277424000000,137485271],[1277683200000,146358254],[1277769600000,283336130],[1277856000000,184867060],[1277942400000,255738140],[1278028800000,173624381],[1278374400000,153808676],[1278460800000,163639812],[1278547200000,184537661],[1278633600000,108393537],[1278892800000,140719236],[1278979200000,297738658],[1279065600000,203042784],[1279152000000,206215849],[1279238400000,259964376],[1279497600000,256124484],[1279584000000,268737511],[1279670400000,296417422],[1279756800000,161329322],[1279843200000,133346661],[1280102400000,105137452],[1280188800000,146192641],[1280275200000,129996090],[1280361600000,160951385],[1280448000000,112113960],[1280707200000,107021026],[1280793600000,104413218],[1280880000000,105139076],[1280966400000,72340618],[1281052800000,111253310],[1281312000000,75781356],[1281398400000,112979405],[1281484800000,155013068],[1281571200000,133729834],[1281657600000,88716635],[1281916800000,79606849],[1282003200000,105662221],[1282089600000,84923923],[1282176000000,106676227],[1282262400000,96057206],[1282521600000,103516812],[1282608000000,150638208],[1282694400000,149216228],[1282780800000,116625803],[1282867200000,137146576],[1283126400000,95821894],[1283212800000,105196602],[1283299200000,174258805],[1283385600000,103856298],[1283472000000,130197067],[1283817600000,85706313],[1283904000000,131637114],[1283990400000,109643597],[1284076800000,96940319],[1284336000000,97194965],[1284422400000,102037313],[1284508800000,107341570],[1284595200000,163025387],[1284681600000,158618691],[1284940800000,164822833],[1285027200000,167418881],[1285113600000,146353774],[1285200000000,196528871],[1285286400000,162371804],[1285545600000,120774913],[1285632000000,258760411],[1285718400000,117410608],[1285804800000,168347452],[1285891200000,112101444],[1286150400000,108824968],[1286236800000,125491450],[1286323200000,167716514],[1286409600000,102099277],[1286496000000,164600814],[1286755200000,106937733],[1286841600000,139634663],[1286928000000,157522589],[1287014400000,108823925],[1287100800000,230548444],[1287360000000,276114391],[1287446400000,308189833],[1287532800000,180406030],[1287619200000,137864321],[1287705600000,93193856],[1287964800000,98107996],[1288051200000,98232337],[1288137600000,99750070],[1288224000000,137761540],[1288310400000,107627128],[1288569600000,105972251],[1288656000000,108482437],[1288742400000,127086848],[1288828800000,160621979],[1288915200000,90313265],[1289174400000,70433307],[1289260800000,95928805],[1289347200000,96056373],[1289433600000,90320433],[1289520000000,198961462],[1289779200000,100900954],[1289865600000,164737342],[1289952000000,119862407],[1290038400000,123622443],[1290124800000,96210793],[1290384000000,98268492],[1290470400000,129861284],[1290556800000,103568136],[1290729600000,59436237],[1290988800000,111439895],[1291075200000,125463303],[1291161600000,115437672],[1291248000000,115912916],[1291334400000,85592283],[1291593600000,112120127],[1291680000000,97863465],[1291766400000,80483501],[1291852800000,73536526],[1291939200000,65644243],[1292198400000,109953333],[1292284800000,87891762],[1292371200000,104327314],[1292457600000,80507098],[1292544000000,96787068],[1292803200000,96402194],[1292889600000,64087884],[1292976000000,66536029],[1293062400000,55875176],[1293408000000,62453699],[1293494400000,43980797],[1293580800000,40817672],[1293667200000,39414991],[1293753600000,48413827],[1294012800000,111280407],[1294099200000,77337001],[1294185600000,63879193],[1294272000000,75106626],[1294358400000,77982212],[1294617600000,112139482],[1294704000000,111019993],[1294790400000,75644310],[1294876800000,74536182],[1294963200000,77209748],[1295308800000,470246700],[1295395200000,283902199],[1295481600000,191197293],[1295568000000,188599712],[1295827200000,143670548],[1295913600000,136716650],[1296000000000,126716779],[1296086400000,71255961],[1296172800000,148014146],[1296432000000,94311602],[1296518400000,106657943],[1296604800000,64738807],[1296691200000,98449148],[1296777600000,80459575],[1297036800000,121254910],[1297123200000,95259906],[1297209600000,120686090],[1297296000000,232137360],[1297382400000,91892948],[1297641600000,77603491],[1297728000000,71043441],[1297814400000,120288833],[1297900800000,132643504],[1297987200000,204011724],[1298332800000,218135561],[1298419200000,167962942],[1298505600000,124974514],[1298592000000,95004483],[1298851200000,100768479],[1298937600000,114032163],[1299024000000,150647189],[1299110400000,125196764],[1299196800000,113316483],[1299456000000,136530149],[1299542400000,89078955],[1299628800000,113349033],[1299715200000,126972055],[1299801600000,117770016],[1300060800000,109113690],[1300147200000,180262334],[1300233600000,289187626],[1300320000000,164854977],[1300406400000,188302604],[1300665600000,102347560],[1300752000000,81558162],[1300838400000,93248498],[1300924800000,101177720],[1301011200000,112292796],[1301270400000,77337407],[1301356800000,88224955],[1301443200000,82351269],[1301529600000,68592006],[1301616000000,104665400],[1301875200000,115020542],[1301961600000,120740809],[1302048000000,100634681],[1302134400000,93361520],[1302220800000,94383317],[1302480000000,99787618],[1302566400000,106627080],[1302652800000,86608963],[1302739200000,75497401],[1302825600000,113458247],[1303084800000,152474427],[1303171200000,104844243],[1303257600000,175163842],[1303344000000,188449618],[1303689600000,66636290],[1303776000000,84400645],[1303862400000,89052887],[1303948800000,90297123],[1304035200000,251585929],[1304294400000,110678246],[1304380800000,78390249],[1304467200000,97312229],[1304553600000,84065352],[1304640000000,70061285],[1304899200000,51188151],[1304985600000,70521969],[1305072000000,84018683],[1305158400000,80239593],[1305244800000,81547956],[1305504000000,112535374],[1305590400000,113196657],[1305676800000,83693267],[1305763200000,65291310],[1305849600000,84547708],[1306108800000,95627217],[1306195200000,80520650],[1306281600000,73555433],[1306368000000,55673751],[1306454400000,50912897],[1306800000000,104434134],[1306886400000,138670602],[1306972800000,84721112],[1307059200000,78360765],[1307318400000,115484677],[1307404800000,132493060],[1307491200000,83471577],[1307577600000,68841199],[1307664000000,108529400],[1307923200000,82414108],[1308009600000,83641901],[1308096000000,99851885],[1308182400000,127647338],[1308268800000,153872649],[1308528000000,160161274],[1308614400000,123343514],[1308700800000,97645436],[1308787200000,139939254],[1308873600000,109981312],[1309132800000,84989933],[1309219200000,73574907],[1309305600000,88179070],[1309392000000,80807391],[1309478400000,108828209],[1309824000000,88818618],[1309910400000,111156241],[1309996800000,99915319],[1310083200000,122481639],[1310342400000,110713974],[1310428800000,112901691],[1310515200000,97909518],[1310601600000,107633155],[1310688000000,121116338],[1310947200000,143157623],[1311033600000,204786344],[1311120000000,235331712],[1311206400000,131629036],[1311292800000,129181885],[1311552000000,147451094],[1311638400000,119145026],[1311724800000,164830470],[1311811200000,148506092],[1311897600000,158145890],[1312156800000,153207957],[1312243200000,250968788],[1312329600000,183125796],[1312416000000,217851424],[1312502400000,301140350],[1312761600000,285951204],[1312848000000,270645704],[1312934400000,219662296],[1313020800000,185491110],[1313107200000,132243405],[1313366400000,115135468],[1313452800000,124722122],[1313539200000,110514943],[1313625600000,212858289],[1313712000000,193970546],[1313971200000,133826210],[1314057600000,164208576],[1314144000000,156566907],[1314230400000,217825076],[1314316800000,160368761],[1314576000000,101313149],[1314662400000,104480264],[1314748800000,130688894],[1314835200000,85930705],[1314921600000,109791514],[1315267200000,127424129],[1315353600000,87643794],[1315440000000,104039460],[1315526400000,141269408],[1315785600000,116957988],[1315872000000,110184487],[1315958400000,133680848],[1316044800000,104454581],[1316131200000,174622161],[1316390400000,205964780],[1316476800000,193937289],[1316563200000,151493755],[1316649600000,242120137],[1316736000000,136620610],[1316995200000,203218862],[1317081600000,158124372],[1317168000000,107463181],[1317254400000,162841147],[1317340800000,137059223],[1317600000000,167269011],[1317686400000,308418887],[1317772800000,196617358],[1317859200000,203145054],[1317945600000,133904162],[1318204800000,110628287],[1318291200000,151420465],[1318377600000,155570982],[1318464000000,106545775],[1318550400000,143341730],[1318809600000,171510696],[1318896000000,220400096],[1318982400000,275998093],[1319068800000,137382294],[1319155200000,155310512],[1319414400000,125589044],[1319500800000,107650200],[1319587200000,114074982],[1319673600000,123713317],[1319760000000,80709748],[1320019200000,96406303],[1320105600000,132946877],[1320192000000,82063667],[1320278400000,110381075],[1320364800000,75556992],[1320624000000,67565799],[1320710400000,100109842],[1320796800000,139670930],[1320883200000,186245269],[1320969600000,163446017],[1321228800000,108265507],[1321315200000,107744812],[1321401600000,87302012],[1321488000000,120030148],[1321574400000,93018765],[1321833600000,112050589],[1321920000000,102324341],[1322006400000,107160445],[1322179200000,63689801],[1322438400000,86660854],[1322524800000,94007858],[1322611200000,101516702],[1322697600000,96794838],[1322784000000,94818290],[1323043200000,89342127],[1323129600000,70951013],[1323216000000,76249929],[1323302400000,94089051],[1323388800000,74285785],[1323648000000,75266366],[1323734400000,84784203],[1323820800000,101788680],[1323907200000,64112125],[1323993600000,105394401],[1324252800000,58881914],[1324339200000,84350728],[1324425600000,65736678],[1324512000000,50589112],[1324598400000,67401964],[1324944000000,66308613],[1325030400000,57214227],[1325116800000,54039041],[1325203200000,44943710],[1325548800000,75564699],[1325635200000,65061108],[1325721600000,67816805],[1325808000000,79596412],[1326067200000,98505792],[1326153600000,64581762],[1326240000000,53798059],[1326326400000,53180911],[1326412800000,56539749],[1326758400000,60724055],[1326844800000,69197758],[1326931200000,65434453],[1327017600000,103492249],[1327276800000,76515446],[1327363200000,136909311],[1327449600000,239565837],[1327536000000,81057711],[1327622400000,74971631],[1327881600000,94832073],[1327968000000,97977985],[1328054400000,67510562],[1328140800000,46698547],[1328227200000,71717009],[1328486400000,62420596],[1328572800000,79055263],[1328659200000,101969280],[1328745600000,221053602],[1328832000000,157824975],[1329091200000,129301606],[1329177600000,115483011],[1329264000000,376528040],[1329350400000,236137405],[1329436800000,133947191],[1329782400000,151396399],[1329868800000,120823808],[1329955200000,142006312],[1330041600000,103819905],[1330300800000,136895304],[1330387200000,150096478],[1330473600000,238000378],[1330560000000,170813188],[1330646400000,107927589],[1330905600000,202280183],[1330992000000,202559651],[1331078400000,199629549],[1331164800000,129110723],[1331251200000,104724732],[1331510400000,101820019],[1331596800000,172712659],[1331683200000,354709747],[1331769600000,289917768],[1331856000000,206371879],[1332115200000,225308790],[1332201600000,204167033],[1332288000000,161010374],[1332374400000,156032898],[1332460800000,107621815],[1332720000000,148934219],[1332806400000,151782141],[1332892800000,163864869],[1332979200000,152059432],[1333065600000,182759395],[1333324800000,149586458],[1333411200000,208638360],[1333497600000,143245095],[1333584000000,160318858],[1333929600000,149384046],[1334016000000,222422452],[1334102400000,174152769],[1334188800000,153582163],[1334275200000,214911067],[1334534400000,262696056],[1334620800000,256371472],[1334707200000,238632471],[1334793600000,208678365],[1334880000000,257743808],[1335139200000,241629479],[1335225600000,269099838],[1335312000000,226427670],[1335398400000,134016274],[1335484800000,101692500],[1335744000000,126535038],[1335830400000,152749513],[1335916800000,106906016],[1336003200000,97637057],[1336089600000,132497421],[1336348800000,115073217],[1336435200000,124312720],[1336521600000,120175923],[1336608000000,83317752],[1336694400000,99886332],[1336953600000,88156103],[1337040000000,119076678],[1337126400000,140223874],[1337212800000,179304713],[1337299200000,183072463],[1337558400000,157772790],[1337644800000,173696754],[1337731200000,146224365],[1337817600000,124049506],[1337904000000,82116552],[1338249600000,95126346],[1338336000000,132355209],[1338422400000,122977603],[1338508800000,130245094],[1338768000000,139247129],[1338854400000,97053376],[1338940800000,100362262],[1339027200000,94993164],[1339113600000,86872870],[1339372800000,147815696],[1339459200000,108894961],[1339545600000,73443230],[1339632000000,86460283],[1339718400000,83813380],[1339977600000,110102790],[1340064000000,90350932],[1340150400000,89789644],[1340236800000,81626258],[1340323200000,71186311],[1340582400000,76088656],[1340668800000,69187503],[1340755200000,50764770],[1340841600000,70760543],[1340928000000,105360031],[1341187200000,100022776],[1341273600000,60428165],[1341446400000,121095121],[1341532800000,104757156],[1341792000000,94850224],[1341878400000,127989407],[1341964800000,117329366],[1342051200000,106997163],[1342137600000,77904449],[1342396800000,75326342],[1342483200000,73453037],[1342569600000,63174888],[1342656000000,109214567],[1342742400000,99367450],[1343001600000,121993795],[1343088000000,141283044],[1343174400000,219314368],[1343260800000,101702580],[1343347200000,101013241],[1343606400000,94784970],[1343692800000,115581676],[1343779200000,96124742],[1343865600000,83062203],[1343952000000,86228604],[1344211200000,75580008],[1344297600000,72627492],[1344384000000,61176080],[1344470400000,55452586],[1344556800000,48765045],[1344816000000,69707463],[1344902400000,85041824],[1344988800000,64377278],[1345075200000,63694204],[1345161600000,110689894],[1345420800000,153345689],[1345507200000,203176260],[1345593600000,141330637],[1345680000000,105029568],[1345766400000,109334113],[1346025600000,106728601],[1346112000000,66844323],[1346198400000,50701084],[1346284800000,75672793],[1346371200000,84579607],[1346716800000,91972629],[1346803200000,84090475],[1346889600000,97845664],[1346976000000,82416145],[1347235200000,121998898],[1347321600000,125984852],[1347408000000,178054492],[1347494400000,149589629],[1347580800000,150118311],[1347840000000,99507499],[1347926400000,93375667],[1348012800000,81715004],[1348099200000,84141932],[1348185600000,142897076],[1348444800000,159936196],[1348531200000,129690449],[1348617600000,144175906],[1348704000000,148522031],[1348790400000,133777077],[1349049600000,135895921],[1349136000000,156997638],[1349222400000,106069719],[1349308800000,92688813],[1349395200000,148501108],[1349654400000,159494867],[1349740800000,209648887],[1349827200000,127588930],[1349913600000,136520097],[1350000000000,115003665],[1350259200000,108124961],[1350345600000,137442816],[1350432000000,97327643],[1350518400000,119155512],[1350604800000,186021017],[1350864000000,136682392],[1350950400000,176786197],[1351036800000,139631772],[1351123200000,164081393],[1351209600000,254605834],[1351641600000,127500471],[1351728000000,90361922],[1351814400000,149843064],[1352073600000,132321224],[1352160000000,93729041],[1352246400000,198412186],[1352332800000,264036339],[1352419200000,232476496],[1352678400000,128950479],[1352764800000,133302610],[1352851200000,119291977],[1352937600000,197477385],[1353024000000,316722763],[1353283200000,205792965],[1353369600000,160687856],[1353456000000,93306759],[1353628800000,68206579],[1353888000000,157644431],[1353974400000,133328454],[1354060800000,130264981],[1354147200000,128674525],[1354233600000,97824986],[1354492800000,91069097],[1354579200000,139482392],[1354665600000,261159353],[1354752000000,294301791],[1354838400000,196941794],[1355097600000,157620575],[1355184000000,148085903],[1355270400000,121783130],[1355356800000,156314627],[1355443200000,252394499],[1355702400000,189736022],[1355788800000,156417023],[1355875200000,112340424],[1355961600000,120421798],[1356048000000,149129554],[1356307200000,43936977],[1356480000000,75609030],[1356566400000,113779680],[1356652800000,88569243],[1356912000000,164872785],[1357084800000,140124866],[1357171200000,88240950],[1357257600000,148581860],[1357516800000,121038176],[1357603200000,114676751],[1357689600000,101899959],[1357776000000,150285296],[1357862400000,87688741],[1358121600000,183544396],[1358208000000,219192932],[1358294400000,172700045],[1358380800000,113412579],[1358467200000,118287267],[1358812800000,115386173],[1358899200000,215375853],[1358985600000,365212953],[1359072000000,301993503],[1359331200000,196378931],[1359417600000,142768017],[1359504000000,104288317],[1359590400000,79833215],[1359676800000,134867089],[1359936000000,119278754],[1360022400000,143336536],[1360108800000,148426012],[1360195200000,176145074],[1360281600000,158288984],[1360540800000,129358516],[1360627200000,152262712],[1360713600000,118801221],[1360800000000,88876501],[1360886400000,97981177],[1361232000000,108944213],[1361318400000,119074886],[1361404800000,111795180],[1361491200000,82663644],[1361750400000,93144464],[1361836800000,125374074],[1361923200000,146836928],[1362009600000,80628737],[1362096000000,138111792],[1362355200000,145684399],[1362441600000,159607042],[1362528000000,115062269],[1362614400000,117117826],[1362700800000,97898983],[1362960000000,118558356],[1363046400000,116477473],[1363132800000,101454192],[1363219200000,75968746],[1363305600000,160989787],[1363564800000,151549090],[1363651200000,131693310],[1363737600000,77165158],[1363824000000,95813410],[1363910400000,98776111],[1364169600000,125283438],[1364256000000,73573423],[1364342400000,82852294],[1364428800000,110745586],[1364774400000,97432489],[1364860800000,132443234],[1364947200000,90803727],[1365033600000,89664638],[1365120000000,95923478],[1365379200000,75264742],[1365465600000,76688115],[1365552000000,93981748],[1365638400000,82154093],[1365724800000,59681279],[1365984000000,79379706],[1366070400000,76442758],[1366156800000,236263461],[1366243200000,166574163],[1366329600000,152318201],[1366588800000,107479442],[1366675200000,166058949],[1366761600000,242458391],[1366848000000,96209155],[1366934400000,191068990],[1367193600000,160081110],[1367280000000,172884362],[1367366400000,126788697],[1367452800000,105506184],[1367539200000,90381788],[1367798400000,124160162],[1367884800000,120938076],[1367971200000,118149038],[1368057600000,99687476],[1368144000000,83712482],[1368403200000,79277310],[1368489600000,111778940],[1368576000000,185403085],[1368662400000,150866478],[1368748800000,107019829],[1369008000000,112893984],[1369094400000,114074240],[1369180800000,110814858],[1369267200000,88345236],[1369353600000,69106639],[1369699200000,96536188],[1369785600000,82695669],[1369872000000,88428648],[1369958400000,96075042],[1370217600000,93087841],[1370304000000,73181521],[1370390400000,72647337],[1370476800000,104268458],[1370563200000,101185686],[1370822400000,112589043],[1370908800000,71426348],[1370995200000,66356668],[1371081600000,71528086],[1371168000000,65672880],[1371427200000,64860453],[1371513600000,48790448],[1371600000000,77757785],[1371686400000,89374558],[1371772800000,120297338],[1372032000000,120186430],[1372118400000,78584786],[1372204800000,91986573],[1372291200000,84350049],[1372377600000,144659417],[1372636800000,97793045],[1372723200000,117521579],[1372809600000,60232158],[1372982400000,68520760],[1373241600000,74578420],[1373328000000,88172238],[1373414400000,70350819],[1373500800000,81618964],[1373587200000,69910463],[1373846400000,60543105],[1373932800000,54134367],[1374019200000,49764064],[1374105600000,54760818],[1374192000000,67194715],[1374451200000,51997596],[1374537600000,92348403],[1374624000000,148013824],[1374710400000,57420636],[1374796800000,50068753],[1375056000000,62110300],[1375142400000,77355565],[1375228800000,80739351],[1375315200000,51562322],[1375401600000,68695326],[1375660800000,79713592],[1375747200000,83728540],[1375833600000,74713968],[1375920000000,63999838],[1376006400000,66905209],[1376265600000,91108290],[1376352000000,220484936],[1376438400000,189092911],[1376524800000,122573507],[1376611200000,90575856],[1376870400000,127629481],[1376956800000,89671743],[1377043200000,83969305],[1377129600000,61051676],[1377216000000,55682221],[1377475200000,82741050],[1377561600000,106047109],[1377648000000,76901678],[1377734400000,59913714],[1377820800000,68100788],[1378166400000,83025166],[1378252800000,86257878],[1378339200000,59091879],[1378425600000,89881253],[1378684800000,85171583],[1378771200000,185798872],[1378857600000,223526688],[1378944000000,101012471],[1379030400000,74708438],[1379289600000,137137665],[1379376000000,99844773],[1379462400000,114215304],[1379548800000,101134712],[1379635200000,174825322],[1379894400000,190526525],[1379980800000,91085743],[1380067200000,79239167],[1380153600000,59305183],[1380240000000,57009729],[1380499200000,65039408],[1380585600000,88470655],[1380672000000,72295902],[1380758400000,80688503],[1380844800000,64717380],[1381104000000,78073107],[1381190400000,72729006],[1381276800000,75431216],[1381363200000,69650490],[1381449600000,66934938],[1381708800000,65474542],[1381795200000,80018603],[1381881600000,62775013],[1381968000000,63398335],[1382054400000,72635570],[1382313600000,99526945],[1382400000000,133515753],[1382486400000,78431122],[1382572800000,96191095],[1382659200000,84448133],[1382918400000,137610123],[1383004800000,158952115],[1383091200000,88540697],[1383177600000,68923785],[1383264000000,68722304],[1383523200000,61157033],[1383609600000,66368071],[1383696000000,55844152],[1383782400000,65655100],[1383868800000,69829543],[1384128000000,56863303],[1384214400000,51114651],[1384300800000,49304927],[1384387200000,70605087],[1384473600000,79479764],[1384732800000,61236224],[1384819200000,52234707],[1384905600000,48545798],[1384992000000,65506861],[1385078400000,55931232],[1385337600000,57348403],[1385424000000,100345728],[1385510400000,90861841],[1385683200000,79532215],[1385942400000,118135885],[1386028800000,112741734],[1386115200000,94452666],[1386201600000,111895315],[1386288000000,86088352],[1386547200000,80123533],[1386633600000,69567610],[1386720000000,89929693],[1386806400000,65572318],[1386892800000,83205283],[1387152000000,70648452],[1387238400000,57475649],[1387324800000,141465807],[1387411200000,80239369],[1387497600000,109103435],[1387756800000,125326831],[1387843200000,41888735],[1388016000000,51002035],[1388102400000,56471317],[1388361600000,63407722],[1388448000000,55819372],[1388620800000,58791957],[1388707200000,98303870],[1388966400000,103359151],[1389052800000,79432766],[1389139200000,64686685],[1389225600000,69905199],[1389312000000,76320664],[1389571200000,94860843],[1389657600000,83734371],[1389744000000,98472619],[1389830400000,57471330],[1389916800000,108426689],[1390262400000,82255544],[1390348800000,95219334],[1390435200000,100978346],[1390521600000,108384437],[1390780800000,144219152],[1390867200000,266833581],[1390953600000,125942796],[1391040000000,169762789],[1391126400000,116336444],[1391385600000,100620772],[1391472000000,94273543],[1391558400000,82322156],[1391644800000,64497223],[1391731200000,93638601],[1391990400000,86451022],[1392076800000,70672252],[1392163200000,77127064],[1392249600000,76960156],[1392336000000,68468036],[1392681600000,65306248],[1392768000000,78554420],[1392854400000,76529103],[1392940800000,69757247],[1393200000000,72364950],[1393286400000,58247350],[1393372800000,69131286],[1393459200000,75557321],[1393545600000,93074653],[1393804800000,59784494],[1393891200000,64884834],[1393977600000,50065519],[1394064000000,46423111],[1394150400000,55415241],[1394409600000,44691430],[1394496000000,70198849],[1394582400000,50195460],[1394668800000,64435609],[1394755200000,59299492],[1395014400000,49886074],[1395100800000,52411863],[1395187200000,56188958],[1395273600000,52099537],[1395360000000,93612169],[1395619200000,88924871],[1395705600000,70573356],[1395792000000,74942224],[1395878400000,55507676],[1395964800000,50141063],[1396224000000,42167188],[1396310400000,50189685],[1396396800000,45104871],[1396483200000,40648111],[1396569600000,68812485],[1396828800000,72462530],[1396915200000,60971883],[1397001600000,51542722],[1397088000000,59912818],[1397174400000,67975012],[1397433600000,51445177],[1397520000000,66622577],[1397606400000,53732994],[1397692800000,71106721],[1398038400000,45668931],[1398124800000,50664453],[1398211200000,98735259],[1398297600000,189978082],[1398384000000,97568814],[1398643200000,167371680],[1398729600000,84344673],[1398816000000,114220883],[1398902400000,61052418],[1398988800000,47878572],[1399248000000,71766758],[1399334400000,93641373],[1399420800000,70715988],[1399507200000,57574363],[1399593600000,72899498],[1399852800000,53324677],[1399939200000,39934594],[1400025600000,41600846],[1400112000000,57711731],[1400198400000,69091834],[1400457600000,79439024],[1400544000000,58708986],[1400630400000,49249914],[1400716800000,50218945],[1400803200000,58052491],[1401148800000,87216605],[1401235200000,78921885],[1401321600000,94118633],[1401408000000,141005137],[1401667200000,92337903],[1401753600000,73231620],[1401840000000,83870521],[1401926400000,75951141],[1402012800000,87620911],[1402272000000,75414804],[1402358400000,62777042],[1402444800000,45681114],[1402531200000,54748791],[1402617600000,54525280],[1402876800000,35561270],[1402963200000,29726347],[1403049600000,33514108],[1403136000000,35527686],[1403222400000,100898066],[1403481600000,43694391],[1403568000000,39036087],[1403654400000,36868541],[1403740800000,32629359],[1403827200000,64028803],[1404086400000,49589028],[1404172800000,38223477],[1404259200000,28465073],[1404345600000,22891753],[1404691200000,56467939],[1404777600000,65221678],[1404864000000,36436440],[1404950400000,39685552],[1405036800000,34018228],[1405296000000,42810155],[1405382400000,45696176],[1405468800000,53502415],[1405555200000,57298243],[1405641600000,49987593],[1405900800000,39079002],[1405987200000,55196597],[1406073600000,92917719],[1406160000000,45728843],[1406246400000,43469117],[1406505600000,55317689],[1406592000000,43143095],[1406678400000,33010001],[1406764800000,56842647],[1406851200000,48511286],[1407110400000,39958144],[1407196800000,55932663],[1407283200000,38558342],[1407369600000,46711179],[1407456000000,41865193],[1407715200000,36584844],[1407801600000,33795352],[1407888000000,31916439],[1407974400000,28115566],[1408060800000,48951331],[1408320000000,47572413],[1408406400000,69399270],[1408492800000,52699192],[1408579200000,33478198],[1408665600000,44183834],[1408924800000,40270173],[1409011200000,33151984],[1409097600000,52369011],[1409184000000,68459801],[1409270400000,44595247],[1409616000000,53564262],[1409702400000,125420521],[1409788800000,85718221],[1409875200000,58457035],[1410134400000,46356742],[1410220800000,189846255],[1410307200000,100869587],[1410393600000,62399743],[1410480000000,64096903],[1410739200000,61316516],[1410825600000,66908133],[1410912000000,60926498],[1410998400000,37299435],[1411084800000,70902406],[1411344000000,52788426],[1411430400000,63402196],[1411516800000,60171828],[1411603200000,100091990],[1411689600000,62370501],[1411948800000,49766312],[1412035200000,55264139],[1412121600000,51491286],[1412208000000,47757828],[1412294400000,43469585],[1412553600000,37051182],[1412640000000,42094183],[1412726400000,57404674],[1412812800000,77376525],[1412899200000,66331592],[1413158400000,53583368],[1413244800000,63688562],[1413331200000,100933600],[1413417600000,72154523],[1413504000000,68179688],[1413763200000,77517279],[1413849600000,94623904],[1413936000000,68263146],[1414022400000,71074674],[1414108800000,47053916],[1414368000000,34187701],[1414454400000,48060949],[1414540800000,52687879],[1414627200000,40654793],[1414713600000,44639285],[1414972800000,52282550],[1415059200000,41574365],[1415145600000,37435905],[1415232000000,34968457],[1415318400000,33691535],[1415577600000,27195547],[1415664000000,27442252],[1415750400000,46942431],[1415836800000,59522855],[1415923200000,44063595],[1416182400000,46746712],[1416268800000,44223978],[1416355200000,41869160],[1416441600000,43395537],[1416528000000,57179298],[1416787200000,47450824],[1416873600000,68840440],[1416960000000,40831886],[1417132800000,24814402],[1417392000000,83814037],[1417478400000,59348940],[1417564800000,43063440],[1417651200000,42155776],[1417737600000,38318895],[1417996800000,57664850],[1418083200000,60208036],[1418169600000,44565318],[1418256000000,41471578],[1418342400000,56028138],[1418601600000,67218082],[1418688000000,60790733],[1418774400000,53411773],[1418860800000,59006218],[1418947200000,88429770],[1419206400000,45167549],[1419292800000,26028419],[1419379200000,14479611],[1419552000000,33720951],[1419811200000,27598920],[1419897600000,29881477],[1419984000000,41403351],[1420156800000,53204626],[1420416000000,64285491],[1420502400000,65797116],[1420588800000,40105934],[1420675200000,59364547],[1420761600000,53699527],[1421020800000,49650790],[1421107200000,67091928],[1421193600000,48956588],[1421280000000,60013996],[1421366400000,78513345],[1421712000000,49899907],[1421798400000,48575897],[1421884800000,53796409],[1421971200000,46464828],[1422230400000,55614979],[1422316800000,95568749],[1422403200000,146477063],[1422489600000,84436432],[1422576000000,83745461],[1422835200000,62739100],[1422921600000,51915749],[1423008000000,70149743],[1423094400000,42246245],[1423180800000,43706567],[1423440000000,38889797],[1423526400000,62008506],[1423612800000,73561797],[1423699200000,74474466],[1423785600000,54272219],[1424131200000,63152405],[1424217600000,44891737],[1424304000000,37362381],[1424390400000,48948419],[1424649600000,70974110],[1424736000000,69228130],[1424822400000,74711746],[1424908800000,91287529],[1424995200000,62014847],[1425254400000,48096663],[1425340800000,37816283],[1425427200000,31666340],[1425513600000,56517146],[1425600000000,72842060],[1425859200000,88528487],[1425945600000,68856582],[1426032000000,68938974],[1426118400000,48362719],[1426204800000,51827283],[1426464000000,35874300],[1426550400000,51023104],[1426636800000,65270945],[1426723200000,45809490],[1426809600000,68695136],[1427068800000,37709674],[1427155200000,32842304],[1427241600000,51655177],[1427328000000,47572869],[1427414400000,39546151],[1427673600000,47099670],[1427760000000,42090553],[1427846400000,40621437],[1427932800000,32220131],[1428278400000,37193975],[1428364800000,35012268],[1428451200000,37329243],[1428537600000,32483974],[1428624000000,40187953],[1428883200000,36365123],[1428969600000,25524593],[1429056000000,28970419],[1429142400000,28368987],[1429228800000,51957046],[1429488000000,47054310],[1429574400000,32435057],[1429660800000,37654505],[1429747200000,45770902],[1429833600000,44525905],[1430092800000,96954207],[1430179200000,118923970],[1430265600000,63386083],[1430352000000,83195423],[1430438400000,58512638],[1430697600000,50988278],[1430784000000,49271416],[1430870400000,72141010],[1430956800000,43940895],[1431043200000,55550382],[1431302400000,42035757],[1431388800000,48160032],[1431475200000,34694235],[1431561600000,45203456],[1431648000000,38208034],[1431907200000,50882918],[1431993600000,44633240],[1432080000000,36454932],[1432166400000,39730364],[1432252800000,45595972],[1432598400000,70697560],[1432684800000,45833246],[1432771200000,30733309],[1432857600000,50884452],[1433116800000,32112797],[1433203200000,33667627],[1433289600000,30983542],[1433376000000,38450118],[1433462400000,35626800],[1433721600000,52674786],[1433808000000,56075420],[1433894400000,39087250],[1433980800000,35390887],[1434067200000,36886246],[1434326400000,43988946],[1434412800000,31494131],[1434499200000,32918071],[1434585600000,35407220],[1434672000000,54716887],[1434931200000,34039345],[1435017600000,30268863],[1435104000000,55280855],[1435190400000,31938100],[1435276800000,44066841],[1435536000000,49161427],[1435622400000,44370682],[1435708800000,30238811],[1435795200000,27210952],[1436140800000,28060431],[1436227200000,46946811],[1436313600000,60761614],[1436400000000,78595038],[1436486400000,61354474],[1436745600000,41440538],[1436832000000,31768139],[1436918400000,33649200],[1437004800000,36222447],[1437091200000,46164710],[1437350400000,58900203],[1437436800000,76756427],[1437523200000,115450607],[1437609600000,50999452],[1437696000000,42162332],[1437955200000,44455540],[1438041600000,33618097],[1438128000000,37011653],[1438214400000,33628268],[1438300800000,42884953],[1438560000000,69975968],[1438646400000,124138623],[1438732800000,99312613],[1438819200000,52903040],[1438905600000,38670405],[1439164800000,54951597],[1439251200000,97082814],[1439337600000,101685610],[1439424000000,48535789],[1439510400000,42929516],[1439769600000,40884745],[1439856000000,34560708],[1439942400000,48286510],[1440028800000,68501622],[1440115200000,128275471],[1440374400000,162206292],[1440460800000,103601599],[1440547200000,96774611],[1440633600000,84616056],[1440720000000,53164407],[1440979200000,56229271],[1441065600000,76845860],[1441152000000,61888812],[1441238400000,53233940],[1441324800000,49996311],[1441670400000,54843626],[1441756800000,85010804],[1441843200000,62675234],[1441929600000,49915473],[1442188800000,58363431],[1442275200000,43341155],[1442361600000,36909956],[1442448000000,63462713],[1442534400000,74285291],[1442793600000,46554289],[1442880000000,50346159],[1442966400000,35756716],[1443052800000,50219475],[1443139200000,56151926],[1443398400000,52109011],[1443484800000,73365384],[1443571200000,66473033],[1443657600000,63929100],[1443744000000,58019758],[1444003200000,52064743],[1444089600000,48196751],[1444176000000,46765550],[1444262400000,61979577],[1444348800000,52766140],[1444608000000,30467204],[1444694400000,33049256],[1444780800000,44462449],[1444867200000,37673452],[1444953600000,39232609],[1445212800000,29759153],[1445299200000,48967763],[1445385600000,42326974],[1445472000000,41654089],[1445558400000,59366914],[1445817600000,66333781],[1445904000000,69884400],[1445990400000,85551352],[1446076800000,51227334],[1446163200000,49365254],[1446422400000,32203267],[1446508800000,45518976],[1446595200000,44886050],[1446681600000,39552680],[1446768000000,33042283],[1447027200000,33871405],[1447113600000,59127931],[1447200000000,45217971],[1447286400000,32525579],[1447372800000,45812403],[1447632000000,38106701],[1447718400000,27616939],[1447804800000,46674697],[1447891200000,43295820],[1447977600000,34287096],[1448236800000,32482528],[1448323200000,42803172],[1448409600000,21388308],[1448582400000,13046445],[1448841600000,39180322],[1448928000000,34852374],[1449014400000,33386563],[1449100800000,41569509],[1449187200000,57776977],[1449446400000,32084249],[1449532800000,34309450],[1449619200000,46361357],[1449705600000,29212727],[1449792000000,46886161],[1450051200000,64318732],[1450137600000,53323105],[1450224000000,56238467],[1450396800000,96453327],[1450656000000,47590610],[1450742400000,32789367],[1450828800000,32657354],[1450915200000,13596680],[1451260800000,26704210],[1451347200000,30931243],[1451433600000,25213777],[1451520000000,40912316],[1451865600000,67281190],[1451952000000,55790992],[1452038400000,68457388],[1452124800000,81094428],[1452211200000,70798016],[1452470400000,49739377],[1452556800000,49154227],[1452643200000,61745031],[1452729600000,62424154],[1452816000000,79010008],[1453161600000,52841349]]}]
	                    navigator : {
	                    	adaptToUpdatedData: false,
	                        enabled : false
	                    },
	                    scrollbar:{
	                    	//liveRedraw: false
	                    },
	                    credits:{
	                    	enabled: false,
	                    }
	                };
	            	
                }// End of setChartConfig
                
                scope.toggled = function(open){
                	if(!open && scope.optionsPrevText != scope.optionsNextText){
                		scope.chartConfig = null; //This will drop the chart directive
                		$timeout(function(){
                			scope.optionsPrevText = scope.optionsNextText;
                    		scope.setChartConfig(); //This will re-create the chart directive
                		});
                	}
                }
                
                scope.setSelected = function($event, opt){
                	$event.stopPropagation();
                	$event.preventDefault();
                	var selected = [], isAll = false;
                	opt.selected = !!!opt.selected;
                	isAll =(opt.name == "Total Revenue" && opt.selected===true);
                	scope.optionsNextText = "";
                	
                	if(opt.name != "Total Revenue")
        				scope.options[0].selected = false;
                	
            		for(var i=1; i < scope.options.length; i++){
            			if(opt.name == "Total Revenue")
            				scope.options[i].selected = opt.selected;
            			else
            				scope.options[0].selected = false;
            			
            			if(scope.options[i].selected===true){
            				scope.optionsNextText += scope.options[i].name;
            				selected.push(scope.options[i]);
            			}
            		}
            		//if(selected.length == scope.options.length-1)
            		//	scope.options[0].selected = true;

            		if(scope.options[0].selected===true){
            			scope.optionsNextText = "";
            			scope.optionsText = "Selected: " + scope.options[0].caption||scope.options[0].name;
            		}else if(selected.length > 0)
            			scope.optionsText = "Selected: ("+ selected.length +")";
            		else 
            			scope.optionsText = "Selected: None";
                }
                
                scope.setChartConfig();
            },
            
            linkD3: function (scope, elem, attr) {

                // DUMMY DATA SECTION ----------------------------------------

                var now = new Date();
                var dummyData = [];
                for (i = 0; i < 365; i++) {
                    var d = new Date();
                    d.setDate(d.getDate() - i);
                    dummyData.push({
                        date: d,
                        revenue: [
                            {
                                name: "type1",
                                value: 0.35 * (2 + Math.cos(Math.PI * 2 * i / 364)) * ( 100 - 80 * Math.random() )
                            },
                            {name: "short", value: 80 - 50 * Math.random()},
                            {name: "pth", value: 90 - 80 * Math.random()},
                            {name: "long", value: 60 - 50 * Math.random()},
                            {name: "cash", value: 60 - 20 * Math.random()}
                        ],
                        regcap: [
                            {name: "type1", value: 105 - 10 * Math.random()},
                            {name: "short", value: 85 - 10 * Math.random()},
                            {name: "pth", value: 95 - 10 * Math.random()},
                            {name: "long", value: 65 - 10 * Math.random()},
                            {name: "cash", value: 65 - 10 * Math.random()}
                        ]
                    })
                }

                var dummyItems = [
                    {name: "type1", label: "Type 1", color: "rgba(0,128,255,1)", show: true},
                    {name: "short", label: "Short", color: "rgba(255,128,0,1)", show: true},
                    {name: "pth", label: "PTH", color: "rgba(0,200,0,1)", show: true},
                    {name: "long", label: "Long", color: "rgba(212,57,58,1)", show: true},
                    {name: "cash", label: "Cash", color: "rgba(155, 95, 252,1)", show: true}
                ];

                var dummyMeasures = [
                    {name: 'revenue', label: 'Revenue'},
                    {name: 'regcap', label: 'Reg Cap'}
                ];

                var dummyPeriods = [
                    {value: 10, label: '10D'},
                    {value: 30, label: '30D'},
                    {value: 91, label: '3M'},
                    {value: 182, label: '6M'},
                    {value: 365, label: '1Y'}
                ];

                //---------------------------------------------------------------

                scope.data = dummyData;
                scope.items = dummyItems;
                scope.measures = dummyMeasures;
                scope.periods = dummyPeriods;

                scope.period = scope.periods[0];
                var widgetHeight = 250;

                var dataStart = 0;
                var dataEnd = 10;
                var brushExt;
                var selected;
                var numItems;
                var itemIndexes;

                var margin = {top: 10, right: 30, bottom: 20, left: 50, mid: 22};
                var miniHeight = 27;

                var svg = d3.select(elem[0]).select("svg.bar-chart-svg");

                scope.stacked = true;

                scope.$watch('measures', function () {
                    if (scope.measures) {
                        scope.measure = scope.measures[0];
                    }
                });

                scope.$watch('items', function (newItems) {
                    if (scope.items) {
                        itemIndexes = [];
                        newItems.forEach(function (val, idx) {
                            if (val.show) itemIndexes.push(idx);
                        });
                        numItems = itemIndexes.length;
                        renderPlot();
                    }
                }, true);

                scope.$watch('period', function (newVal, oldVal) {
                    if (newVal && newVal !== oldVal) {
                        dataStart = 0;
                        dataEnd = Math.min(newVal.value, scope.data.length);
                        renderPlot();
                    }
                }, true);

                scope.$watchGroup(['measure', 'data', 'stacked'], function (newVal, oldVal) {
                    if (scope.measure && scope.period && scope.data) {
                        renderPlot();
                    }
                }, true);


                var innerElem = elem.children()[1];

                function renderPlot() {

                    if (!itemIndexes) return;
                    if (itemIndexes.length === 0) return;

                    var data = scope.data;

                    var dataOpt = scope.measure.name;

                    var outerWidth = innerElem.clientWidth,
                        outerHeight = widgetHeight;

                    var width = outerWidth - margin.left - margin.right,
                        height = outerHeight - margin.top - margin.mid - miniHeight - margin.bottom;

                    d3.select(elem[0]).selectAll("svg.bar-chart-svg>g").remove();

                    svg.attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.mid + miniHeight + margin.bottom);

                    var mainArea = svg.append('g')
                        .attr("class", "mainArea")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                    var miniArea = svg.append('g')
                        .attr("class", "miniArea")
                        .attr("transform", "translate(" + margin.left + "," + (margin.top + height + margin.mid) + ")");

                    var brushArea = svg.append('g')
                        .attr("class", "brushArea")
                        .attr("transform", "translate(" + margin.left + "," + (margin.top + height + margin.mid) + ")");

                    var axisRange = d3.range(data.length);

                    axisRange.shift();

                    axisRange.push((axisRange[axisRange.length - 1] + 1));

                    var xScale1 = d3.scale.ordinal()
                        .rangeBands([width, 0], 0.2, 0)
                        .domain(data.map(function (d) {
                            return d.date;
                        }));

                    var yScale1 = d3.scale.linear()
                        .range([height, 0])
                        .domain([0, d3.max(data, function (d) {
                            var arr = itemIndexes.map(function (itemIdx) {
                                return d[dataOpt][itemIdx]["value"];
                            });
                            return Math.max.apply(Math, arr);
                        })]);

                    var xScale2 = d3.scale.ordinal()
                        .rangeBands([width, 0], 0, 0)
                        .domain(data.map(function (d) {
                            return d.date;
                        }));

                    var yScale2 = d3.scale.linear()
                        .range([miniHeight, 0]);

/*                    if (scope.stacked) {*/
                    yScale2.domain([0, d3.max(data, function (d) {
                        var sum = 0;
                        itemIndexes.forEach(function (itemIdx) {
                            sum += d[dataOpt][itemIdx]["value"];
                        });
                        return sum;
                    })]);
/*                    } else {
                        yScale2.domain([0, d3.max(data, function (d) {
                            var arr = itemIndexes.map(function (itemIdx) {
                                return d[dataOpt][itemIdx]["value"];
                            });
                            return Math.max.apply(Math, arr);
                        })]);
                    }*/

                    var xScaleBrush = d3.scale.ordinal()
                        .rangeBands([width, 0], 0.2, 0)
                        .domain(axisRange);

                    var xAxis1 = d3.svg.axis()
                        .scale(xScale1)
                        .tickSize(3, 0)
                        .ticks(4)
                        .tickFormat(d3.time.format("%b-%d"))
                        .orient("bottom");

                    var yAxis1 = d3.svg.axis()
                        .scale(yScale1)
                        .tickSize(-width, 0)
                        .ticks(4)
                        .orient("left");

                    var tickPad = 80;
                    var nTicks = Math.round(width / tickPad);
                    var nPoints = xScale2.domain().length;
                    var iTick = Math.round(nPoints / nTicks);

                    var xTicks = xScale2.domain().filter(function (d, i, a) {
                        return ( !(i % iTick) && (nPoints - 1 - i > (iTick / 2)) ) || (i == nPoints - 1);
                    });

                    var xAxis2 = d3.svg.axis()
                        .scale(xScale2)
                        .tickSize(3, 0)
                        .tickValues(xTicks)
                        .tickFormat(d3.time.format("%b-%d"))
                        .orient("bottom");

                    var brush = d3.svg.brush()
                        .x(xScaleBrush)
                        .extent(brushExt || [0, 0])
                        .on("brush", onBrush);

                    brushArea.append("g")
                        .attr("class", "brush")
                        .call(brush)
                        .selectAll("rect")
                        .attr("opacity", 0.25)
                        .attr("height", miniHeight);

                    svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(" + margin.left + "," + (margin.top + height + margin.mid + miniHeight) + ")")
                        .call(xAxis2);

                    var hoverDiv = d3.select(elem[0]).select(".hover-container").style("display", "none");
                    var hoverLab = d3.select(elem[0]).select(".hover-label");

                    var barWidth2;

                    var area2 = d3.svg.area()
                        .x(function (d, i) {
                            return xScale2(d.date) + 0.5 * xScale2.rangeBand();
                        })
                        .y0(function (d) {
                            return yScale2(0);
                        })
                        .y1(function (d) {
                            var total = 0;
                            for (var j = 0; j < itemIndexes.length; j++) {
                                total += d[dataOpt][itemIndexes[j]]["value"];
                            }
                            return yScale2(total);
                        });

                    miniArea.append("path")
                        .attr("fill", "rgba(0, 0, 160, 1)")
                        .datum(data)
                        .attr("d", area2);

                    //if (scope.stacked) {
                    //	barWidth2 = xScale2.rangeBand();
                    //	itemIndexes.forEach(function(itemIdx, idx){
                    //		miniArea.selectAll(".bar-"+scope.items[itemIdx].name).data(data)
                    //			.enter().append("rect")
                    //			.attr("class","bar")
                    //			.attr("class","bar-"+scope.items[itemIdx].name)
                    //           .attr("fill", scope.items[itemIdx].color)
                    //           //.attr("fill", "#000000")
                    //			.attr("x", function(d) { return xScale2(d.date);})
                    //			.attr("width", function(d) { return barWidth2;})
                    //			.attr("y", function(d) {
                    //				var y=0;
                    //				for (var j=0;j<idx;j++) {
                    //					y += d[dataOpt][itemIndexes[j]]["value"];
                    //				}
                    //				return yScale2(d[dataOpt][itemIdx]["value"] + y);
                    //			})
                    //           .attr("height", function(d) { return miniHeight - yScale2(d[dataOpt][itemIdx]["value"]);})
                    //			.attr("opacity", 1);
                    //	});
                    //} else {
                    //	barWidth2 = xScale2.rangeBand()/numItems;
                    //	itemIndexes.forEach(function(itemIdx, idx){
                    //		miniArea.selectAll(".bar-"+scope.items[itemIdx].name).data(data)
                    //			.enter().append("rect")
                    //			.attr("class","bar")
                    //			.attr("class","bar-"+scope.items[itemIdx].name)
                    //			.attr("x", function(d) { return xScale2(d.date) + idx*barWidth2;})
                    //			.attr("width", function(d) { return barWidth2;})
                    //			.attr("y", function(d) { return yScale2(d[dataOpt][itemIdx]["value"]);})
                    //			.attr("height", function(d) { return miniHeight - yScale2(d[dataOpt][itemIdx]["value"]);})
                    //			.attr("fill", scope.items[itemIdx].color)
                    //			.attr("opacity", 1);
                    //	});
                    //}

                    var updatedData = data.slice(dataStart, dataEnd);

                    update(updatedData);

                    function onBrush() {

                        selected = xScaleBrush.domain()
                            .filter(function (d) {
                                return (brush.extent()[0] <= xScaleBrush(d)) && (xScaleBrush(d) <= brush.extent()[1]);
                            });

                        brushExt = brush.extent();

                        if (selected.length > 1) {
                            dataStart = selected[0] - 1;
                            dataEnd = selected[selected.length - 1];
                        } else {
                            dataStart = 0;
                            dataEnd = data.length;
                        }
                        var updatedData = data.slice(dataStart, dataEnd);

                        update(updatedData);

                    }

                    function update(data) {

                        xScale1.domain(data.map(function (d) {
                            return d.date;
                        }));

                        if (scope.stacked) {
                            yScale1.domain([0, d3.max(data, function (d) {
                                var sum = 0;
                                itemIndexes.forEach(function (itemIdx) {
                                    sum += d[dataOpt][itemIdx]["value"];
                                });
                                return sum;
                            })]);

                        } else {
                            yScale1.domain([0, d3.max(data, function (d) {
                                var arr = itemIndexes.map(function (itemIdx) {
                                    return d[dataOpt][itemIdx]["value"];
                                });
                                return Math.max.apply(Math, arr);
                            })]);
                        }

                        var tickPad = 80;
                        var nTicks = Math.round(width / tickPad);
                        var nPoints = xScale1.domain().length;
                        var iTick = Math.round(nPoints / nTicks);

                        var xTicks = xScale1.domain().filter(function (d, i, a) {
                            return ( !(i % iTick) && (nPoints - 1 - i > (iTick / 2)) ) || (i == nPoints - 1);
                        });

                        xAxis1.tickValues(xTicks).scale(xScale1);
                        yAxis1.scale(yScale1);

                        svg.select("g.x.axis.axis-1").remove();
                        svg.select("g.y.axis.axis-1").remove();

                        svg.append("g")
                            .attr("class", "x axis axis-1")
                            .attr("transform", "translate(" + margin.left + "," + (margin.top + height) + ")")
                            .call(xAxis1);

                        svg.append("g")
                            .attr("class", "y axis axis-1")
                            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                            .call(yAxis1);

                        svg.on("mousemove", function () {
                            onMouseMove(this);
                        }).on("mouseout", onMouseOut);

                        itemIndexes.forEach(function (itemIdx, idx) {

                            var selection = mainArea.selectAll(".bar-" + scope.items[itemIdx].name).data(data);

                            selection.exit().remove();

                            selection.enter().append("rect")
                                .attr("class", "bar")
                                .attr("class", "bar-" + scope.items[itemIdx].name)
                                .attr("fill", scope.items[itemIdx].color)
                                .on("mouseenter", function (d) {
                                    onMouseOver(this, d[dataOpt][itemIdx], scope.items[itemIdx])
                                })
                                .attr("opacity", 1);

                            var barWidth1;

                            if (scope.stacked) {
                                barWidth1 = xScale1.rangeBand();
                                selection
                                    .attr("x", function (d) {
                                        return xScale1(d.date);
                                    })
                                    .attr("width", function (d) {
                                        return barWidth1;
                                    })
                                    .attr("y", function (d) {
                                        var y = 0;
                                        for (var j = 0; j < idx; j++) {
                                            y += d[dataOpt][itemIndexes[j]]["value"];
                                        }
                                        return yScale1(d[dataOpt][itemIdx]["value"] + y);
                                    })
                                    .attr("height", function (d) {
                                        return height - yScale1(d[dataOpt][itemIdx]["value"]);
                                    });
                            } else {
                                barWidth1 = xScale1.rangeBand() / numItems;
                                selection
                                    .attr("x", function (d) {
                                        return xScale1(d.date) + idx * barWidth1;
                                    })
                                    .attr("width", function (d) {
                                        return barWidth1;
                                    })
                                    .attr("y", function (d) {
                                        return yScale1(d[dataOpt][itemIdx]["value"]);
                                    })
                                    .attr("height", function (d) {
                                        return height - yScale1(d[dataOpt][itemIdx]["value"]);
                                    });
                            }

                        });

                    }

                    var yOffset = height + miniHeight + margin.mid + margin.top + margin.bottom + 10;

                    function onMouseOver(selection, data, item) {
                        hoverDiv
                            .style("display", null)
                            .style("background-color", item.color);
                        hoverLab
                            .html($filter('number')(data.value, 2));
                    }

                    function onMouseMove(selection) {
                        var mouse = d3.mouse(selection);
                        hoverDiv
                            .style("left", (mouse[0] - 60) + 'px')
                            .style("bottom", (yOffset - mouse[1]) + 'px');
                    }

                    function onMouseOut() {
                        hoverDiv
                            .style("display", "none");
                    }

                }

            }
        })

	}]);
	
	return RevenueTrend;
})